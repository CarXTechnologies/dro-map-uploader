Инструкция по загрузке трассы в workshop из модового проекта

1. Подготовка проекта загрузки трасс
2. Импорт 3d модели трассы в проект
3. Добавление основных компонентов
  a. Назначение коллизий поверхности
  b. Назначение точки появления на карте
  c. Назначение звуков окружения
  d. Добавление мини-карты
4. Выгрузка трассы в workshop

1. Подготовка проекта загрузки трасс
   Для начала необходимо выкачать сам проект. Он доступен по ссылке https://github.com/CarXTechnologies/dro-map-uploader Подключите свой аккаунт Github. Можно выкачать zip-архив и распаковать в любом месте файловой системы
   (Code → Download ZIP)
   Далее, чтобы открыть проект, Вам необходимо установить редактор Unity, нужна версия Unity 2020.3.25, ссылка для скачивания (только для 64x разрядных систем)   
   https://download.unity3d.com/download_unity/9b9180224418/Windows64EditorInstaller/UnitySetup64-2020.3.25f1.exe
   Следующим шагом запускаем Unity, выбираем меню File → Open Project и выбираем папку, содержащую распакованный проект (в этой папке должны быть папки Assets, Packages и т.д.)
   Проект подготовлен, можно переходить к следующему пункту

2. Импорт 3d модели трассы в проект
  В папке Assets/MapResources/ создайте папку с рабочим названием карты. 
  В созданной папке необходимо создать сцену через меню Assets →  Create → Scene.
  Далее нужно загрузить .fbx/.obj/.dae (Collada) из таких программ, как например Blender/Maya/Autodesk 3ds max. Для этого через Drag&Drop нужно перенести 3d модель в папку  Assets/MapResources/%your_folder%/
  Если материалы не настроены в моделях, то создайте материал через меню Assets → Create → Material и настройте (пример см. ниже)
  Откройте созданную сцену (п. 2) и создайте объект сцены (GameObject) путем переноса 3d модели на сцену. 
  Для созданного GameObject добавьте необходимые компоненты (раздел 3).
  Для создания многоразового объекта (Prefab) создайте папку  Assets/MapResources/%your_folder%/ Prefabs.
  На объекте в сцене нажмите правой кнопкой мыши и выберите меню Prefab → Unpack Comletely.
  Далее перенесите GameObject в созданную папку Prefabs из сцены. Таким образом появляется возможность повторно использовать объект нужное количество раз.
3. Добавление основных компонентов
   Проект поддерживает несколько типов компонентов, которые переносятся в игру. Основные из них: 
   точка появления авто на карте, звуки окружения, физические материалы поверхностей

Эти компоненты назначаются через вспомогательный компонент GameMarkerData.
Для добавления компонента у объекта сцены (GameObject) или объекта в проекте (Prefab) в окне инспектора (Inspector) нажмите кнопку Add Component и введите имя GameMarkerData. 
Также есть возможность добавить мини-карту.

a. Назначение коллизий поверхности
Для объекта трассы, представлющего поверхность выберите тип компонента GameMarkerData Road, и в дропдауне выберите необходимый тип материала, который будет использоваться в игре при наезде на данную поверхность.

Обратите внимание, что любой GameObject/Prefab с коллизией должен быть также с каким-либо компонентом типа Collider (Box/Sphere/Capsule/Mesh Collider). Данное условие необходимо для корректности столкновений.

b. Назначение точки появления на карте
Для назначения точки появления на карте выберите пункт меню GameObect → Create Empty (или Ctrl+Shift+N). В компоненте Transform выставите координаты точки, наиболее подходящей для появления авто в игре. Добавьте компонент GameMarkerData, и выберите тип SpawnPoint

c. Назначение звуков окружения
Для назначения точки появления на карте выберите пункт меню GameObect → Create Empty (или Ctrl+Shift+N). Добавьте компонент GameMarkerData, и выберите тип Ambient. Далее в дропдауне выберите тип звука, наиболее подходящий обстановке на карте.

При добавления маркера типа Ambient можно использовать компонент DrawZoneBehaviour - это вспомогательный компонент, который отрисовывает зону действия компонента. Например для маркера типов Ambient данный компонент покажет зону, в которой будут слышны назначенные звуки.
Если необходим другой вспомогательный скрипт, то его можно написать самому и добавить свой по пути Assets/Resources/MapSkipComponent

d. Добавление мини-карты
Есть возможность также добавить необязательный объект миникарты. Для этого необходимо  создать пустой объект на сцене (см. выше) и добавить компонент Minimap. Далее необходимо выбрать слой (Layer) Minimap. В поле Textures → Element 0 нужно назначить хотя бы одну текстуру - MainTexture

4. Выгрузка трассы в workshop
Для выгрузки нужно сначала создать конфиг карты в папке карты
Далее необходимо настроить конфиг. Для этого нужно:
- *указать название рабочей сцены.
- *ввести имя карты, которое будет отображаться в workshop
- ввести описание карты, которое будет отображаться в workshop
- *назначить Icon - иконка карты, которая будет отображаться в списке workshop карт в самой игре
- *назначить Large icon - превью карты, которое будет отображаться в workshop и при входе в карту в самой игре
- Item Workshop Id - id карты, получаемый при загрузке в workshop (назначается автоматически после публикации)
- Upload Steam Description - если включено, то описание на странице в workshop обязательно будет обновлено
- Upload Steam Name - если включено, то имя карты на странице в workshop обязательно будет обновлено
- Upload Steam Preview - если включено, то иконка карты на странице в workshop обязательно будет обновлена
(*) - обязательное поле

Для установки сцены в качестве сборки в Steam, выберите MapMetaConfig который создали до этого в Resources/MapManagerConfig
Когда всё готово, время экспортировать в steam, для этого откройте steam, после есть
несколько пунктов для выбора сборки

Create - Просто собрать карту, если ошибок нет. То карта сделана правильно. Так же создаёт промежуточный результат в Asset/{MapName}

Create and publication - Собирает карту и отправляет в мастерскую, если карта собирается и успешно проходит стадию публикации то ошибок в консоли не будет

Update exist publication - обновляет существующую публикацию к которой у вас есть доступ, id последней публикации указывается в поле Item Workshop Id

Если карта настроена неправильно, то при выгрузке отобразиться ошибка, причины которой будет необходимо устранить самостоятельно.

После выполнения данных пунктов карта будет опубликована в steam workshop. Изначально видимость загруженной карты будет как “Приватная“. Так, можно протестировать созданную карту в игре, и она будет видна только автору. Для этого в игре необходимо зайти в меню Мастерская → Мастерская трасс. Изменить видимость на “Для всех“ можно на странице карты в workshop.

Важно! В данный момент не корректно работает видимость “Только для друзей“. Это связано с проблемой на стороне внешней библиотеки, через которую мы работаем с api стима. Этой проблемой займемся в последующих релизах.
